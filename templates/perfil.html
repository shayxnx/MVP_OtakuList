<nav>
    <ul>
        <li><a href="{{ url_for('homepage') }}">Início</a></li>
        <li><a href="{{ url_for('all_animes') }}">Animes</a></li>
        <li><a href="{{ url_for('my_list') }}">Minha Lista</a></li>

        {% if usuario %}
            <li><a href="{{ url_for('profile') }}">Perfil</a></li>
            <li><a href="{{ url_for('logout') }}">Sair</a></li>
        {% else %}
            <li><a href="{{ url_for('login_page') }}">Entrar</a></li>
            <li><a href="{{ url_for('cadastro_page') }}">Cadastrar</a></li>
        {% endif %}
    </ul>
</nav>

<h1>Perfil</h1>

<link rel="stylesheet" href="/static/style.css">

<div class="perfil-info">
    <img id="user-avatar" src="/static/img/avatar.jpg" width="100" alt="Avatar">
    
    <h2 id="user-name">{{ usuario.nome or usuario.email }}</h2> 
    
    <p>Email: {{ usuario.email }}</p>
</div>

<div class="edicao-container">
    <h3>Editar Nome do Perfil</h3>
    <form id="formEdicaoNome">
        <label for="novo_nome">Novo Nome:</label>
        <input type="text" id="novo_nome" name="novo_nome" value="{{ usuario.nome or '' }}" required>
        <button type="submit">Salvar Nome</button>
    </form>
    <p id="msg-edicao" class="error"></p>
</div>

<div>
    <h3>Estatísticas</h3>
    <p>Total: <span id="stat-total">0</span></p>
    <p>Assistindo: <span id="stat-watching">0</span></p>
    <p>Assistidos: <span id="stat-completed">0</span></p>
    <p>Dropados: <span id="stat-dropped">0</span></p>
</div>

<script src="/static/app.js"></script>
<script>
   
    const formEdicao = document.getElementById('formEdicaoNome');
    const msgEdicao = document.getElementById('msg-edicao');
    const userNameElement = document.getElementById('user-name');

    formEdicao.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const novoNome = document.getElementById('novo_nome').value;
        msgEdicao.textContent = '';
        
        try {
            const response = await fetch('/api/perfil/atualizar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                
                body: JSON.stringify({ nome: novoNome })
            });
            
            const data = await response.json();

            if (data.success) {
                
                userNameElement.textContent = data.novo_nome;
                msgEdicao.textContent = '✅ Perfil atualizado!';
                
                window.location.reload(); 
            } else {
                msgEdicao.textContent = `❌ Erro: ${data.message}`;
            }

        } catch (error) {
            msgEdicao.textContent = '❌ Erro de comunicação com o servidor.';
        }
    });

</script>


</body>
</html>
